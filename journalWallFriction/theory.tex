%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Theory}
\label{sec:theory}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
If a control input causes the particles to collide with obstacles at different times, inverting the control input does not undo the action. Due to this lack of time-reversibility, techniques that require a bidirectional graph, e.g. PRM and RRT* are not suitable \cite{lavalle2006planning,kavraki1996probabilistic}. Instead, this paper employs a graph search. This section starts with a boundary interaction model in subsection \ref{subsec:WallFriction}.

Our algorithms rely on holding one particle stationary by pushing it into the boundary while moving the other particle. In subsections \ref{subsec:square} and \ref{subsec:circular} we provide shortest-path results for two representative workspaces, squares and circles.
\subsection{Boundary Interaction Model}\label{subsec:WallFriction}

In the absence of obstacles, uniform inputs move a swarm identically.  
Independent control requires breaking this symmetry. 
The following sections examine using non-slip boundary contacts to break the symmetry caused by uniform inputs.  
 
 If the $i^{\textrm{th}}$ particle has position $\mathbf{x}_i(t)$ and velocity $\dot{\mathbf{x}}_i(t)$,  we assume the following system model:
 \begin{align}\label{eq:swarmDynamicsAndFric} 
\dot{\mathbf{x}}_i(t)
 &=
 \mathbf{u}(t)
 +F \left( \mathbf{x}_i(t), \mathbf{u}(t) \right), ~i \in [1,n].\\
 F(\mathbf{x}_i(t), \mathbf{u}(t)) &= \begin{cases}
  - \mathbf{u}(t) &\begin{matrix} \mathbf{x}_i(t) \in  \textrm{boundary \textbf{and}}\\
\mathbf{N}(\textrm{boundary$(\mathbf{x}_i(t))$})\cdot   \mathbf{u}(t) \le 0 \end{matrix}
 \\
 0 & \textrm{else}.
 \end{cases}\nonumber
 \end{align}
 Here  $F(\mathbf{x}_i(t), \mathbf{u}(t)) $ is the frictional force provided by the boundary, and
 $\mathbf{N}(\textrm{boundary$(\mathbf{x}_i(t))$})$ is the normal to the boundary at position $\mathbf{x}_i(t)$.
 
 
These system dynamics represent particle swarms in low-Reynolds number environments, where viscosity dominates inertial forces and so velocity is proportional to input force~\cite{Purcell1977}. 
 In this regime, the input force command $\mathbf{u}(t)$ controls the velocity of the particles.  
  The same model can be generalized to particles moved by fluid flow where the vector direction of fluid flow $\mathbf{u}(t)$ controls the velocity of particles, or for a swarm of particles that move at a constant speed in a direction specified by a uniform input $\mathbf{u}(t)$~\cite{Rubenstein2012}.
  As in our model, fluid flowing in a pipe has zero velocity along the boundary. Similar mechanical systems exist at larger scales, e.g. all tumblers of a combination lock move uniformly unless obstructed by an obstacle.
 Our control problem is to design the control inputs $\mathbf{u}(t)$ to make all $n$ particles achieve a task.
 
 \subsection{Example: Shortest Path in a Square Workspace}\label{subsec:square}
 
 If the goal configuration cannot be reached in one move but can be reached in three moves, the shortest path has a simple solution. The first move, $m_1$, makes one particle hit a wall, $m_2$ adjusts the relative spacing error  to zero, and $m_3$ takes the particles to their final positions. 
$m_2$ cannot be shortened, so optimization depends on choosing the location where the particle hits the wall. 
 Since the shortest distance between two points is a straight line, reflecting the goal position across the boundary wall and plotting a straight line gives the optimal hit location, as shown in Fig. \ref{fig:reflection}. There are four walls, and four candidate solutions.
 
\begin{figure}
\centering
\begin{overpic}[width=0.49\columnwidth]{Reflection.pdf}\end{overpic}
\begin{overpic}[width=0.49\columnwidth]{ReflectionPlot.pdf}\end{overpic}
\caption{\label{fig:reflection}
The shortest ?three-move path that reconfigures two particles has the property that the incident angle equals the reflected angle.
} \vspace{-1em}
\end{figure}

 
 \subsection{Shortest Path in Unit Disk that Intersects Circumference}\label{subsec:circular}
 The shortest path between two points in the unit disk that intersects the circumference is composed of two straight line segments, as shown in Fig.~\ref{fig:shortestpath}. The problem can be simplified by choosing the coordinate system carefully. We define the $x$ axis along the position of the starting point: $S=(s,0)$, and define the point of intersection by the angle $\theta$ from the $x$ axis: $P=(\cos \theta,\sin \theta)$. Define the final point $E$ by a radius $e$ and angle $\beta$: $E=e(\cos \beta,\sin \beta)$. Then the length of the two line segments is 
 \begin{equation}
\scriptsize{ \sqrt{(s-\cos \theta)^2+\sin^2 \theta}+\sqrt{(e \sin \beta-\cos \theta)^2+(e \sin \beta-\sin \theta)^2}},
 \end{equation}
 which is minimized by choosing an appropriate $\theta$ value. This equation can be simplified to 
 
 \begin{equation}
\sqrt{1+s^2-2 s \cos \theta}+  \sqrt{1+e^2-2 e \cos(\beta-\theta)}. 
 \end{equation}
 
\begin{figure}
\centering
\renewcommand{\figwid}{\columnwidth}
{\begin{overpic}[width =\figwid]{shortestpath.pdf}
\end{overpic}
}
\caption{\label{fig:shortestpath}{The shortest path between two points (blue square) to (blue ellipse) in the unit disk that intersects the circumference. The path length as a function of intersection point, $(\cos\theta,\sin\theta)$ is shown at right. See \cite{BeckerShortestPath}.}
%\vspace{-1em}
}
\end{figure}

 
 The length of the two line segments as a function of $\theta$ is drawn in the right plot of Fig.~\ref{fig:shortestpath}. There are several simple solutions. If $s$ is 1 or $e$ is 0 or $\beta$ is 0, the optimal angle $\theta^*$ is 0. If $e$ is 1 or $s$ is 0, the optimal angle is $\beta$. Label the origin $O$. The optimal solution shows that the angle $\angle{OPS}$ (from the origin to $P$ to $S$) is the same as the angle $\angle{OPE}$ (from the origin to $P$ to $E$). We name these angles $\alpha$. This can be proved by drawing an ellipse whose foci are $S$ and $E$. When the ellipse is tangent to the circle, the point of tangency is exactly $P$. 
  Since the distance from the origin to $P$ is always 1, we can set up three equalities using the law of sines:
 From triangle $OSP$: $\frac{\sin \alpha}{s}=\frac{\sin(\alpha + \theta)}{1}=\frac{\sin \theta}{||SP||}$, and from triangle $OEP$: $\frac{\sin \alpha}{e}=\frac{\sin(\beta - \theta)}{||EP||}$. If we mirror the point $S$ about the $\theta$ axis and label this point $C$, from triangle $CEO$: $\frac{\sin(\alpha + \theta)}{e}=\frac{\sin(2 \theta - \beta)}{||CE||}$.
 
 Simplifying this system of equations results in $s=e \csc \theta (s \sin(2 \theta-\beta)+\sin(\beta-\theta))$. Solving this last equation results in a quartic solution that has a closed-form solution with four roots, each of which can be either a clockwise or a counterclockwise rotation $\theta$, depending on the sign of $\beta$, with $-\pi\leq\beta\leq\pi$. We evaluate each and select the solution that results in the shortest length path. This optimal path satisfies the law of reflection off the unit circle, with angle of incidence equal to angle of reflection. For an interactive Mathematica demonstration of this shortest path, see \cite{BeckerShortestPath}.
 
  
 