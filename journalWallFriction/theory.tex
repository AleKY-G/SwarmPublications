%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Theory}
\label{sec:theory}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Boundary Interaction Model}\label{subsec:WallFriction}

In the absence of obstacles uniform inputs move a swarm identically.  
Independent control requires breaking this symmetry. 
The following sections examine using non-slip boundary contacts to break the symmetry caused by uniform inputs.  
 
 If the $i^{\textrm{th}}$ particle has position $\mathbf{x}_i(t)$ and velocity $\dot{\mathbf{x}}_i(t)$,  we assume the following system model:
 \begin{align}\label{eq:swarmDynamicsAndFric} 
\dot{\mathbf{x}}_i(t)
 &=
 \mathbf{u}(t)
 +F \left( \mathbf{x}_i(t), \mathbf{u}(t) \right), ~i \in [1,n].\\
 F(\mathbf{x}_i(t), \mathbf{u}(t)) &= \begin{cases}
  - \mathbf{u}(t) &\begin{matrix} \mathbf{x}_i(t) \in  \textrm{boundary \textbf{and}}\\
\mathbf{N}(\textrm{boundary$(\mathbf{x}_i(t))$})\cdot   \mathbf{u}(t) \le 0 \end{matrix}
 \\
 0 & \textrm{else} 
 \end{cases}\nonumber
 \end{align}
 Here $\mathbf{N}(\textrm{boundary$(\mathbf{x}_i(t))$})$ is the normal to the boundary at position $\mathbf{x}_i(t)$, and
 $F(\mathbf{x}_i(t), \mathbf{u}(t)) $ is the frictional force provided by the boundary.
 
 
These system dynamics represent particle swarms in low-Reynolds number environments, where viscosity dominates inertial forces and so velocity is proportional to input force~\cite{Purcell1977}. 
 In this regime, the input force command $\mathbf{u}(t)$ controls the velocity of the robots.  
  The same model can be generalized to particles moved by fluid flow where the vector direction of fluid flow $\mathbf{u}(t)$ controls the velocity of particles, or for a swarm of robots that move at a constant speed in a direction specified by a uniform input $\mathbf{u}(t)$~\cite{Rubenstein2012}.
  As in our model, fluid flowing in a pipe has zero velocity along the boundary. Similar mechanical systems exist at larger scales, e.g. all tumblers of a combination look move uniformly unless obstructed by an obstacle.
 Our control problem is to design the control inputs $\mathbf{u}(t)$ to make all $n$ particles achieve a task.
 
 
 \subsection{Shortest Path}
 The shortest path between two points in the unit disk that reflects off the circumference is composed of two straight line segments shown in Fig.~\ref{fig:shortestpath}. The problem can be simplified by choosing the coordinate system carefully. We define the x axis along the position of the starting point: $S=(s,0)$, and define the point of intersection by the angle $\theta$ from the $x$ axis $P=(\cos \theta,\sin \theta)$, and the final point by a radius e and angle $\beta$, $E=e(\cos \beta,\sin \beta)$. Then define a symmetry point about S of line OP named T. Then the length of the two line segments is 
 \begin{equation}
\scriptsize{ \sqrt{(s-\cos \theta)^2+(-\sin \theta)^2}+\sqrt{(e \sin \beta-\cos \theta)^2+(e \sin \beta-\sin \theta)^2}}
 \end{equation}
 which is minimized by choosing an appropriate $\theta$ value. This equation can be simplified to 
 
 \begin{equation}
 \sqrt{1+e^2-2 e \cos(\beta-\theta)}+\sqrt{1+s^2-2 s \cos \theta}. 
 \end{equation}
 
\begin{figure}
\centering
\renewcommand{\figwid}{\columnwidth}
{\begin{overpic}[width =\figwid]{shortestpath.pdf}
\end{overpic}
}
\caption{\label{fig:shortestpath}{The shortest path between two points (blue square) to (blue ellipse) in the unit disk that intersects the circumference. The path length as a function of intersection point, $(\cos\theta,\sin\theta)$ is shown at right.}
%\vspace{-1em}
}
\end{figure}

 
 The length of the two line segments as a function of $\theta$ is drawn in the right plot. There are several simple solutions. If $s$ is 1 or $e$ is 0 or $\beta$ is 0, the optimal angle $\theta^*$ is 0. If $e$ is 1 or $s$ is 0, the optimal angle is $\beta$. Label the origin $O$. The optimal solution shows that the angle $\angle{OPS}$ (from the origin to P to S) is the same as the angle $\angle{OPE}$ (from the origin to P to E). We name these angles $\alpha$. This can be proved by drawing an ellipse whose foci are S and E. When the ellipse is tangent to the circle, the point of tangency is exactly P. 
  Since the distance from the origin to P is always 1, we can set up three equalities using the law of sines:
 From triangle OSP: $\frac{\sin \alpha}{s}=\frac{\sin(\alpha + \theta)}{1}=\frac{\sin \theta}{SP}$, and from triangle OEP: $\frac{\sin \alpha}{e}=\frac{\sin(\beta - \theta)}{EP}$. If we mirror the point S about the $\theta$ axis and label this point C, from triangle CEO: $\frac{\sin(\alpha + \theta)}{e}=\frac{\sin(2 \theta - \beta)}{CE}$.
 
 Simplifying this system of equations results in: $s=e \csc \theta (s \sin(2 \theta-\beta)+\sin(\beta-\theta))$. Solving this last equation results in a quartic solution that has a closed-form solution with four roots, each of which can be either a clockwise or a counterclockwise rotation $\theta$, depending on the sign of $\beta$, with $-\pi<=\beta<=\pi$. We evaluate each and select the solution that results in the shortest length path. Note that the optimal path satisfies the law of reflection off the unit circle, with angle of incidence equal to angle of reflection.
 
 \subsection{Different Polygonal Workspaces}
 
 Fig. \ref{fig:polygon} shows different workspaces and their representative $\Delta$ configuration spaces. Consider one robot touching each vertex of the workspace. For each pair of vertices, compute where the other robot will be if the first robot goes to that vertex. If the final position of the second robot is still inside the workspace, then its position is one of the vertices of the reachable set. If the point is not inside the polygon, then the intersection of the line that point and the second robot's position with the polygon is one vertex of the reachable set. Compute the distance to all the vertices of the workspace from this point. By subtracting the relative distance of the robots, then all the vertices of one reachable set are found. Doing this for all the vertices of the workspace will give us all the reachable sets.
 \begin{figure}
\centering
\renewcommand{\figwid}{0.8\columnwidth}
{\begin{overpic}[width =\figwid]{differentNumSides.pdf}\put(5,100){Workspace}\put(20,100){$\Delta$ configuration space}
\end{overpic}
}
\caption{\label{fig:polygon}{Workspace and $\Delta$ configuration spaces for different polygonal workspaces and their representative $\Delta$ configuration spaces and reachable sets. As the number of sides in the polygon increases, the total area of the $\Delta$ configuration space is four times of the workspace.
}
\vspace{-1em}
}
\end{figure}

\todo{latex line over the top of two vertices}

\begin{figure*}
\centering
\renewcommand{\figwid}{0.66\columnwidth}
\begin{overpic}[width =\figwid]{anypolygon1.pdf}
\end{overpic}
\begin{overpic}[width =\figwid]{anypolygon2.pdf}
\end{overpic}
\begin{overpic}[width =\figwid]{anypolygon3.pdf}
\end{overpic}
\caption{\label{fig:polygonAlg}{ Steps to generate  the reachable set when  one particle collides with edge $i,i+1$ of a convex polygonal workspace.}
\vspace{-1em}
}
\end{figure*}

 
 
 