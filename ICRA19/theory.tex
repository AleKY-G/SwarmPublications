%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Torque control}
%\label{sec:theory}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsection{Controlling Torque}

%We derive inspiration from recent work on pulling with a swarm \cite{pulltogether}. The contribution of this work is to map swarm distributions to torque production.
%The orientation of an object's major axis is important when a swarm is manipulating a non-symmetric object through narrow corridors. 
%Orientation is controllable by applying torque to the object. 
%To change the output torque $\tau$ in~\eqref{eq:torque}, we can choose the direction and magnitude of the force applied $F$, and the moment arm from the object's center of mass (COM) $O$ to the point of contact $P$.
%We define a coordinate frame rooted at the COM, with the $x$-axis parallel to the object's longest axis. The resulting torque is:
%
%\begin{equation}
%\tau = F \times (P - O ).\label{eq:torque}
%\end{equation}
%
%We assume that the forces produced by individual particles add linearly. 
% As \cite{pulltogether} indicates, this is often a simplification of the true dynamics. 
% The swarm version of \eqref{eq:torque} is the summation of the forces contributed by $n$ individual particles:
%\begin{align}
%\tau_{\text{total}} &= \sum\limits_{i=1}^n \rho_i F_i \times (P_i - O ) \textrm{      and}   \label{eq:swarmtorque}\\
%F_{\text{total}} &= \sum\limits_{i=1}^n \rho_i F_i.  \label{eq:swarmforce}
%\end{align}
%Here $F_i$ is the force that the $i^{\textrm{th}}$ particle applies. 
%Not all particles are in contact with the object.  
%$\rho_i$ is an indicator variable: $\rho_i=1$ if the particle is in direct contact with the object or touching a chain of particle where at least one particle is in contact with the object. 
% Otherwise $\rho_i = 0$.
%The moment arm is the particle's position $P_i$ to the object's COM $O=[O_x,O_y]^{\top}$. 
% If all particles are identical and the control input is uniform, the force is equivalent for every particle and so $F_i $ equals some constant.
%

\section{Angle of repose}\label{sec:angle}

 \begin{figure}
\centering
\renewcommand{\figwid}{\columnwidth}
\begin{overpic}[width =\figwid]{Angle.pdf}%\put(1,55){a)}
\end{overpic}
\caption{\label{fig:angle}  If particles move faster than the (pink) rod, some particles slide past the rod, but the ones that remain pile up in a shape characterized by the angle of repose $\alpha$, which is particular to the particle type.
%Different values of angle of repose is shown when granular particles move faster than the rod.
}
\end{figure}


Consider a swarm of granular particles applying force to a rod. 
If the rod moves slower than the particles, some particles will slide past the rod, but other particles will build up behind the rod in a characteristic triangular shape %defined by an apex angle. 
 defined by a steepest angle of descent perpendicular to the direction of particle motion. 
This piling up is common to all granular media, and the angle formed is a function of the \emph{angle of repose}. Three different values of angle of repose is shown in Fig.~\ref{fig:angle}. The center of mass of the rod is in the middle of the rod, but center of mass of the granular particles changes for different values of angle of repose. % for the media, see \cite{angleofRepose}. 
 By measuring the angle of repose for the particles shown in the top plot of Fig.~\ref{fig:AngleOfReposeForce}, we can estimate the force and torque that the swarm is applying to the rod as a function of the rod's length, the angle of repose, and orientation of the rod.
 In this plot, particulate is moving in the $-y$ direction, and the rods are tilted at $\theta=\{-45,-22.5,0,22.5,45\}^\circ$ with respect to the $x$ axis. 
  A thin black line extends upwards from the rod COM, and the COM of the particulate is shown by a white and black disk.   
  More particulate is heaped on the right side of the rod for positive $\theta$ and more on the left side for negative $\theta$. 
  This uneven particulate generates a restoring torque. 
 We define the angle of repose as $\alpha$, the rod's orientation relative to 90$^\circ$ from the particle movement vector as $\theta$, and the rod's length as $\ell$. 

\subsection{Force and Torque}

By integrating over the triangular shape, the force applied to the rod (when a unit area of particles produces 1 N of force) is
\begin{figure}
\centering
\renewcommand{\figwid}{\columnwidth}
\begin{overpic}[width =\figwid]{AngleOfRepose.pdf}%\put(1,55){a)}
\end{overpic}\\
\vspace{0.5em}
\begin{overpic}[width =\figwid]{AngleOfReposeForce.pdf}%\put(1,55){a)}
\end{overpic}\\
\vspace{0.5em}
\begin{overpic}[width =\figwid]{AngleOfReposeTorque.pdf}%\put(1,55){a)}
\end{overpic}
\vspace{-0.5em}
\caption{\label{fig:AngleOfReposeForce} Top plot shows colored particulate heaped up on pink-colored long rods. 
 Middle plot shows the force applied to the rod and bottom the torque as a function of $\theta$ for four angle of repose values.
   The maximum torque values from \eqref{eq:maxTorqueAngleGivenAOR} are shown with black dots, producing a line that is approximately $-\ell^3/36 \theta_{t_{\max}}$.
% Generating code is in the attachment. 
\vspace{-2em}
}
\end{figure}

\begin{align}
F(\theta,\alpha,\ell) =\left\{
\begin{array}{ll}
\frac{\ell^2\Big(\cos(2\theta)-\cos(2\alpha)\Big)}{8\cos(\alpha)\sin(\theta)} &   -\alpha<\theta<\alpha\\
0 &    \textrm{otherwise .}\\
\end{array} 
\right . \label{eq:ForceAOR}
\end{align}


%\begin{align}
%F(\theta,\alpha,l)  = \frac{l^2}{8\cos\alpha\sin{\theta}} \Big(\cos(2\theta)-\cos(2\alpha)\Big).
%\end{align}

The force for different angle of repose values are shown in the middle plot of Fig.~\ref{fig:AngleOfReposeForce}, with the rod length $\ell=1$. 
Torque will also be similarly defined as
\begin{align}
\tau(\theta, \alpha, \ell) =\left\{
\begin{array}{ll}
\frac{\ell^3\Big(\cos(2\alpha)-\cos(2\theta)\Big)\sin(\theta) }{48\sin^2(\alpha)}&   -\alpha<\theta<\alpha\\
0 &    \textrm{otherwise .}\\
\end{array} 
\right.
\end{align}
Torque is shown in the bottom plot of Fig.~\ref{fig:AngleOfReposeForce} with the rod length $\ell=1$. 
 Given sufficient particles to pile up to the angle of repose, this torque tends to stabilize the object to be perpendicular to the pushing direction.
Force is maximized with $\theta=0$, but the $\theta$ value that maximizes torque is a function of $\alpha$ and is defined as
\begin{align}\label{eq:maxTorqueAngleGivenAOR}
\theta_{t_{\max}} = \frac{\sin(\alpha)}{\sqrt{3}}.
\end{align}
To maximize the torque a particulate swarm applies on a thin rod, the swarm should move in the direction $-\theta_{t_{\max}} - 90^\circ$ with respect to the long axis of the rod.

\subsection{Shape Control}

Often the angle of the rigid rod is given, but we can choose the desired approach direction $\beta$. 
 This section examines the possible shapes that can be generated given a rigid rod of length $\ell$, an angle of repose $\alpha$, and an approach angle where the swarm moves at angle relative to the long axis of the rod $\beta$.

Computing means, variances, covariance, and correlation requires integrating over $R$, the region containing the swarm and are calculated as%This is simplified using an indicator function $\bm{1}_A(x,y)$ that returns 1 if inside the region containing the swarm, and 0 else. 
%The formulas for means $(\bar{x},\bar{y})$, covariance $(\sigma^2_x,\sigma^2_y,\sigma_{xy})$, and correlation $\rho_{xy}$ are as follows: %, integrated over the unit square with $x$ and $y$ from 0 to 1:
%
\begin{align}
A &=\iint_R \,dx\,dy \text{, }
\bar{x} =\frac{\iint_R x \,dx\,dy}{A} \label{eq:meanInSquareWorkspace}
\text{, } \bar{y}=\frac{\iint_R y \,dx\,dy}{A} \text{, }\\
%\end{align}
%\begin{align}
\sigma^2_x &=\frac{\iint_R \left(x-\bar{x}\right)^2  \,dx \,dy}{A}  \label{eq:varInSquareWorkspace}
\text{, } \sigma^2_y =\frac{\iint_R  \left(y-\bar{y}\right)^2 \,dx \,dy}{A}  \text{, }\\
%\end{align}
%\begin{align}
\sigma_{xy} &= \frac{\iint_R  \left(x-\bar{x}\right) \left(y-\bar{y}\right) \, dx \,dy}{A} \label{eq:covAndcorrInSquareWorkspace}
\text{, }\rho_{xy} = \frac{\sigma_{xy}}{\sqrt{\sigma^2_x\sigma^2_y}}.
\end{align}

Using these equations, we can calculate the representative shape statistics as a function of approach angle $\beta$, a one degree-of-freedom set. 
For instance, the area $A$ of the particles is \eqref{eq:ForceAOR} with $\theta = \beta + \pi/2$, and the $y$-variance is
\begin{align}
\sigma_y^2(\alpha, \beta,\ell) &= \frac{1}{72}   \left( \cot(2\alpha) + \frac{\cos(2\beta)}{ \cos(2\alpha)} \right)^2.
\end{align}
Representative results are shown in Fig.~\ref{fig:AngleOfReposeStatistics}.



\begin{figure}
\centering
\renewcommand{\figwid}{\columnwidth}
\begin{overpic}[width =\figwid]{aorYmean}%\put(1,55){a)}
\end{overpic}\\
\vspace{0.5em}
\begin{overpic}[width =\figwid]{aorVarX}%\put(1,55){a)}
\end{overpic}\\
\vspace{0.5em}
\begin{overpic}[width =\figwid]{aorCovariance}%\put(1,55){a)}
\end{overpic}
\vspace{-0.5em}
\caption{\label{fig:AngleOfReposeStatistics} 
Each plot shows a statistic of the swarm shape for several angle of repose $\alpha$ values as a function of the approach angle $\beta$ with $\ell = 1$.
Top plot shows the mean $y$ coordinate $\bar{y}$,
 middle plot shows $x$-variance $\sigma^2_x$, and
 bottom plot shows the covariance $\sigma_{xy}$.
\vspace{-2em}
}
\end{figure}

